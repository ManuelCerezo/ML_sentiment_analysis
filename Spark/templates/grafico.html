<!doctype html>
<html lang="es">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Bootstrap5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <!--CDN CHARTJS-->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <!-- JQUERY-->
        <script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
    <title>Hello, world!</title>
  </head>
  <body>
    <div>
      <canvas id="myChart"></canvas>
    </div>

    <script>
    var cant_datos = 0    
    function addData(chart, label, dataVader,textblob) {
      chart.data.labels.push(label)
      chart.data.datasets[0].data.push(dataVader)
      chart.data.datasets[1].data.push(textblob)
      chart.update();
    }
    function removeData(chart) {
      console.log("removing")
      chart.data.labels.pop();
      chart.data.datasets.forEach((dataset) => {
          dataset.data.pop();
      });
      chart.update();
}

    </script>

    <script>
      var labels = [
        '',
      ];
      const data = {
        labels: labels,
        datasets: [
          {
          label: 'VaderSentiment',
          backgroundColor: 'rgb(255, 99, 132)',
          borderColor: 'rgb(255, 99, 132)',
          data: [0,0],
        },{
          label: 'TextBlob',
          backgroundColor: 'rgb(25, 99, 132)',
          borderColor: 'rgb(205, 99, 132)',
          data: [0,0],
        }
      
      ],
      };

      const config = {
        type: 'line',
        data: data,
        options: {}
      };
      const myChart = new Chart(
        document.getElementById('myChart'),
        config
      );

      setInterval(function(){
            $.getJSON(                            //Get some values from the server
                'http://localhost:5000/puerta-enlace/getdatos',      // At this URL
                {},                                // With no extra parameters
                function(data){
                  var i = 0

                  console.log(data)
                  for(i = 0;i<cant_datos;i++){
                    removeData(myChart)
                  }
                  for(i = 0;i<data.labels.length;i++){
                    //Modificar data por que es un diccionario
                    addData(myChart,data.labels[i],data.data.vader[i],data.data.textblob[i])
                  }
                  console.log("cant_datos: ",cant_datos, "data.labels.length: ",data.labels.length)
                  cant_datos = data.labels.length
                }
            );
          },5000); 
    </script>
    
  </body>
</html>
